<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arctic Monitor - Preview</title>
    <link rel="icon" href="/assets/favicon.svg" type="image/svg+xml">
    <style>
/* Arctic Monitor - Deep Blue Chrome Theme */
:root {
    --bg-deep: #060a18;
    --bg-card: #0c1228;
    --bg-card-hover: #111a38;
    --border-frost: rgba(37, 99, 235, 0.2);
    --border-frost-hover: rgba(37, 99, 235, 0.4);
    --accent: #2563eb;
    --accent-light: #3b82f6;
    --accent-bright: #60a5fa;
    --accent-dim: rgba(37, 99, 235, 0.12);
    --text-primary: #e8ecf4;
    --text-secondary: #a0aec0;
    --text-muted: #5a6a82;
    --green: #34d399;
    --amber: #fbbf24;
    --red: #f87171;
    --pink: #ec4899;
    --pink-dim: rgba(236, 72, 153, 0.15);
    --pink-glow: rgba(236, 72, 153, 0.25);
    --chrome: #c8d0dc;
    --radius: 12px;
    --radius-sm: 8px;
}

*, *::before, *::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    font-family: 'SF Mono', 'Cascadia Code', 'Fira Code', 'JetBrains Mono', monospace;
    background: var(--bg-deep);
    color: var(--text-primary);
    min-height: 100vh;
    line-height: 1.5;
    -webkit-font-smoothing: antialiased;
}

/* Icons */
.icon {
    width: 16px;
    height: 16px;
    vertical-align: -2px;
    margin-right: 6px;
    stroke: var(--accent-bright);
    flex-shrink: 0;
}

.svc-icon {
    width: 16px;
    height: 16px;
    stroke: var(--text-muted);
    flex-shrink: 0;
}

a.service-card:hover .svc-icon {
    stroke: var(--accent-bright);
}

.link-icon {
    width: 10px;
    height: 10px;
    vertical-align: -1px;
    margin-left: 4px;
    stroke: var(--text-muted);
    opacity: 0.5;
}

a.service-card:hover .link-icon {
    stroke: var(--accent-bright);
    opacity: 1;
}

.inline-icon {
    width: 14px;
    height: 14px;
    vertical-align: -2px;
    margin-right: 2px;
}

.inline-icon.ok { stroke: var(--green); }
.inline-icon.warn { stroke: var(--amber); }
.inline-icon.err { stroke: var(--red); }

/* Disk metrics row */
.metrics-grid-disks {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
    margin-top: 12px;
}

/* Header */
.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 24px;
    background: linear-gradient(180deg, rgba(12, 18, 40, 0.95) 0%, rgba(6, 10, 24, 0.8) 100%);
    border-bottom: 1px solid var(--border-frost);
    position: sticky;
    top: 0;
    z-index: 100;
    backdrop-filter: blur(20px);
}

.header-left {
    display: flex;
    align-items: center;
    gap: 12px;
}

.logo-icon {
    color: var(--accent-light);
    filter: drop-shadow(0 0 10px rgba(37, 99, 235, 0.5));
}

.header h1 {
    font-size: 16px;
    font-weight: 700;
    letter-spacing: 3px;
    color: var(--chrome);
    text-shadow: 0 0 24px rgba(37, 99, 235, 0.4);
}

.header-right {
    display: flex;
    align-items: center;
    gap: 16px;
    font-size: 13px;
    color: var(--text-secondary);
}

.header-uptime {
    opacity: 0.8;
}

.header-clock {
    font-variant-numeric: tabular-nums;
    color: var(--accent-bright);
}

.sse-status {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--text-muted);
    transition: background 0.3s;
}

.sse-status.connected {
    background: var(--green);
    box-shadow: 0 0 6px var(--green);
}

.sse-status.disconnected {
    background: var(--red);
    box-shadow: 0 0 6px var(--red);
}

/* Dashboard Grid */
.dashboard {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
    padding: 20px 24px;
    max-width: 1600px;
    margin: 0 auto;
}

/* Cards */
.card {
    background: var(--bg-card);
    border: 1px solid var(--border-frost);
    border-radius: var(--radius);
    padding: 20px;
    backdrop-filter: blur(10px);
    transition: border-color 0.3s, box-shadow 0.3s;
    box-shadow: 0 0 0 1px var(--pink-dim), 0 0 20px rgba(37, 99, 235, 0.05);
}

.card:hover {
    border-color: var(--pink);
    box-shadow: 0 0 0 1px var(--pink-glow), 0 0 30px rgba(236, 72, 153, 0.1), 0 0 60px rgba(37, 99, 235, 0.08);
}

.card-wide { grid-column: span 4; }
.card-full { grid-column: span 4; }
.card-half { grid-column: span 2; }

.card-title {
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 2.5px;
    color: var(--chrome);
    margin-bottom: 16px;
    font-weight: 700;
}

/* Host Metrics */
.metrics-grid-main {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 16px;
}

.metrics-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
}

/* Per-core CPU grid */
.cpu-cores-section {
    margin-top: 14px;
}

.cpu-cores-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
    gap: 4px;
    margin-top: 6px;
}

.cpu-core-bar {
    height: 22px;
    background: rgba(255, 255, 255, 0.06);
    border-radius: 3px;
    overflow: hidden;
    position: relative;
    display: flex;
    align-items: center;
}

.cpu-core-fill {
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    border-radius: 3px;
    transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    background: linear-gradient(90deg, #1d4ed8, var(--accent-light));
    box-shadow: 0 0 6px rgba(37, 99, 235, 0.3);
}

.cpu-core-id {
    position: relative;
    z-index: 1;
    font-size: 10px;
    font-weight: 600;
    color: var(--text-muted);
    margin-left: 6px;
    min-width: 14px;
}

.cpu-core-pct {
    position: absolute;
    right: 6px;
    z-index: 1;
    font-size: 11px;
    font-weight: 600;
    color: var(--text-primary);
    text-shadow: 0 1px 2px rgba(0,0,0,0.5);
    font-variant-numeric: tabular-nums;
}

.cpu-core-avg .cpu-core-fill {
    background: linear-gradient(90deg, #7c3aed, #a78bfa);
    box-shadow: 0 0 6px rgba(124, 58, 237, 0.3);
}

.cpu-core-avg .cpu-core-id {
    color: var(--text-secondary);
}

.metrics-grid-3 {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 16px;
    margin-top: 12px;
}

.metric-header {
    display: flex;
    justify-content: space-between;
    font-size: 12px;
    margin-bottom: 6px;
    color: var(--text-secondary);
}

.metric-header span:last-child {
    font-variant-numeric: tabular-nums;
    color: var(--text-primary);
}

.bar {
    height: 6px;
    background: rgba(255, 255, 255, 0.06);
    border-radius: 3px;
    overflow: hidden;
}

.bar-fill {
    height: 100%;
    border-radius: 3px;
    transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
}

.bar-cpu {
    background: linear-gradient(90deg, #1d4ed8, var(--accent-light));
    box-shadow: 0 0 10px rgba(37, 99, 235, 0.4);
}

.bar-ram {
    background: linear-gradient(90deg, #7c3aed, #a78bfa);
    box-shadow: 0 0 10px rgba(124, 58, 237, 0.3);
}

.bar-gpu {
    background: linear-gradient(90deg, var(--green), #6ee7b7);
    box-shadow: 0 0 10px rgba(52, 211, 153, 0.3);
}

.bar-swap {
    background: linear-gradient(90deg, #db2777, #f472b6);
    box-shadow: 0 0 10px rgba(219, 39, 119, 0.3);
}

.bar-disk-nvme {
    background: linear-gradient(90deg, var(--accent), var(--accent-bright));
    box-shadow: 0 0 10px rgba(37, 99, 235, 0.3);
}

.bar-disk-hdd {
    background: linear-gradient(90deg, var(--amber), #fde68a);
    box-shadow: 0 0 10px rgba(251, 191, 36, 0.3);
}

/* Animated aurora shimmer on bars */
.bar-fill::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
    animation: shimmer 3s infinite;
}

@keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}

.metrics-info {
    display: flex;
    gap: 10px;
    margin-top: 14px;
    flex-wrap: wrap;
}

.info-chip {
    font-size: 11px;
    color: var(--text-secondary);
    background: rgba(37, 99, 235, 0.06);
    padding: 4px 10px;
    border-radius: 4px;
    border: 1px solid rgba(37, 99, 235, 0.1);
}

/* Service Grid */
.service-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 10px;
}

.service-card {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px 14px;
    background: rgba(37, 99, 235, 0.04);
    border: 1px solid rgba(37, 99, 235, 0.08);
    border-radius: var(--radius-sm);
    transition: background 0.2s, border-color 0.2s;
    text-decoration: none;
    color: inherit;
    cursor: default;
}

a.service-card {
    cursor: pointer;
}

a.service-card:hover {
    background: rgba(37, 99, 235, 0.1);
    border-color: var(--border-frost-hover);
}

.service-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
    transition: background 0.3s, box-shadow 0.3s;
}

.service-dot.healthy {
    background: var(--green);
    box-shadow: 0 0 6px var(--green);
    animation: pulse 2s infinite;
}

.service-dot.unhealthy {
    background: var(--red);
    box-shadow: 0 0 6px var(--red);
}

.service-dot.starting {
    background: var(--amber);
    box-shadow: 0 0 6px var(--amber);
}

.service-dot.running {
    background: var(--accent-light);
    box-shadow: 0 0 6px var(--accent-light);
}

.service-dot.stopped {
    background: var(--text-muted);
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.6; }
}

.service-info {
    min-width: 0;
}

.service-name {
    font-size: 12px;
    font-weight: 600;
    color: var(--text-primary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.service-meta {
    font-size: 10px;
    color: var(--text-muted);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* Streams Table */
.table-wrap {
    overflow-x: auto;
}

.streams-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 12px;
}

.streams-table th {
    text-align: left;
    padding: 8px 12px;
    color: var(--text-muted);
    font-weight: 600;
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 1px;
    border-bottom: 1px solid rgba(37, 99, 235, 0.12);
}

.streams-table td {
    padding: 10px 12px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.04);
    color: var(--text-secondary);
}

.streams-table tr {
    transition: background 0.2s;
}

.streams-table tbody tr:hover {
    background: rgba(37, 99, 235, 0.06);
}

.progress-mini {
    width: 60px;
    height: 4px;
    background: rgba(255, 255, 255, 0.06);
    border-radius: 2px;
    overflow: hidden;
    display: inline-block;
    vertical-align: middle;
    margin-right: 6px;
}

.progress-mini-fill {
    height: 100%;
    background: var(--accent-light);
    border-radius: 2px;
    transition: width 0.5s;
}

/* Torrent Stats */
.torrent-stats {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    margin-bottom: 14px;
}

.stat-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 6px 10px;
    background: rgba(37, 99, 235, 0.04);
    border-radius: 4px;
    font-size: 12px;
}

.stat-label {
    color: var(--text-muted);
}

.stat-value {
    color: var(--text-primary);
    font-variant-numeric: tabular-nums;
}

.torrent-list, .download-list, .request-list, .health-list {
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.torrent-item, .download-item, .request-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 10px;
    background: rgba(37, 99, 235, 0.04);
    border-radius: 4px;
    font-size: 11px;
    gap: 8px;
}

.torrent-item-name, .download-item-name, .request-item-name {
    color: var(--text-secondary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    flex: 1;
    min-width: 0;
}

.torrent-item-stats, .download-item-stats, .request-item-meta {
    display: flex;
    gap: 10px;
    flex-shrink: 0;
    color: var(--text-muted);
    font-variant-numeric: tabular-nums;
}

/* Download progress bar */
.download-progress {
    width: 80px;
    height: 4px;
    background: rgba(255, 255, 255, 0.06);
    border-radius: 2px;
    overflow: hidden;
}

.download-progress-fill {
    height: 100%;
    background: var(--accent-light);
    border-radius: 2px;
    transition: width 0.5s;
}

/* Request status badges */
.status-badge {
    font-size: 10px;
    padding: 2px 8px;
    border-radius: 3px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.status-badge.approved { background: rgba(52, 211, 153, 0.15); color: var(--green); }
.status-badge.pending { background: rgba(251, 191, 36, 0.15); color: var(--amber); }
.status-badge.declined { background: rgba(248, 113, 113, 0.15); color: var(--red); }
.status-badge.available { background: rgba(37, 99, 235, 0.2); color: var(--accent-bright); }

/* Transcoding */
.transcode-info {
    margin-bottom: 12px;
}

.transcode-workers {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.worker-card {
    padding: 10px 12px;
    background: rgba(37, 99, 235, 0.04);
    border-radius: var(--radius-sm);
    border: 1px solid rgba(37, 99, 235, 0.08);
}

.worker-header {
    display: flex;
    justify-content: space-between;
    font-size: 11px;
    margin-bottom: 6px;
}

.worker-file {
    color: var(--text-secondary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    flex: 1;
    min-width: 0;
}

.worker-stats {
    color: var(--text-muted);
    flex-shrink: 0;
    margin-left: 10px;
}

/* Health warnings */
.health-item {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    padding: 10px 12px;
    background: rgba(37, 99, 235, 0.04);
    border-radius: 4px;
    font-size: 12px;
    border-left: 3px solid var(--amber);
}

.health-item.error {
    border-left-color: var(--red);
}

.health-source {
    font-weight: 600;
    color: var(--text-primary);
    flex-shrink: 0;
    min-width: 70px;
}

.health-message {
    color: var(--text-secondary);
}

/* Empty state */
.empty-state {
    color: var(--text-muted);
    font-size: 12px;
    text-align: center;
    padding: 20px;
    font-style: italic;
}

/* Data transition animation */
.fade-update {
    animation: fadeUpdate 0.4s ease;
}

@keyframes fadeUpdate {
    0% { opacity: 0.5; }
    100% { opacity: 1; }
}

/* Responsive */
@media (max-width: 1200px) {
    .dashboard {
        grid-template-columns: repeat(2, 1fr);
    }
    .card-wide, .card-full {
        grid-column: span 2;
    }
    .metrics-grid, .metrics-grid-main {
        grid-template-columns: repeat(2, 1fr);
    }
    .metrics-grid-3 {
        grid-template-columns: repeat(2, 1fr);
    }
    .metrics-grid-disks {
        grid-template-columns: 1fr;
    }
    .cpu-cores-grid {
        grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
    }
    .library-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    .ssh-columns {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 768px) {
    .dashboard {
        grid-template-columns: 1fr;
        padding: 12px;
        gap: 12px;
    }
    .card-wide, .card-full, .card-half {
        grid-column: span 1;
    }
    .metrics-grid, .metrics-grid-main, .metrics-grid-3, .metrics-grid-disks {
        grid-template-columns: 1fr;
    }
    .cpu-cores-grid {
        grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
    }
    .header {
        flex-wrap: wrap;
        padding: 12px 16px;
    }
    .header h1 {
        font-size: 13px;
        letter-spacing: 2px;
    }
    .header-actions {
        order: 3;
        width: 100%;
        justify-content: center;
        margin-top: 8px;
    }
    .torrent-stats {
        grid-template-columns: 1fr;
    }
    .service-grid {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    }
    .library-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    .ssh-columns {
        grid-template-columns: 1fr;
    }
    .ssh-summary {
        flex-wrap: wrap;
    }
}

/* Topbar action buttons */
.header-actions {
    display: flex;
    gap: 8px;
}

.btn-action {
    display: flex;
    align-items: center;
    gap: 5px;
    padding: 5px 12px;
    border: 1px solid var(--border-frost);
    border-radius: 6px;
    background: rgba(37, 99, 235, 0.08);
    color: var(--text-secondary);
    font-family: inherit;
    font-size: 11px;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
}

.btn-action:hover {
    background: rgba(37, 99, 235, 0.18);
    border-color: var(--accent-light);
    color: var(--text-primary);
}

.btn-action.danger {
    border-color: rgba(248, 113, 113, 0.2);
    background: rgba(248, 113, 113, 0.06);
}

.btn-action.danger:hover {
    background: rgba(248, 113, 113, 0.15);
    border-color: var(--red);
    color: var(--red);
}

.btn-action svg {
    width: 12px;
    height: 12px;
}

.btn-action.loading {
    opacity: 0.6;
    pointer-events: none;
}

/* Library Stats */
.library-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
}

.library-stat {
    text-align: center;
    padding: 14px 10px;
    background: rgba(37, 99, 235, 0.06);
    border: 1px solid rgba(37, 99, 235, 0.1);
    border-radius: var(--radius-sm);
    transition: border-color 0.2s;
}

.library-stat:hover {
    border-color: var(--pink-dim);
}

.library-stat-value {
    font-size: 24px;
    font-weight: 700;
    color: var(--accent-bright);
    font-variant-numeric: tabular-nums;
    line-height: 1.2;
}

.library-stat-label {
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    color: var(--text-muted);
    margin-top: 4px;
}

/* Confirm dialog overlay */
.confirm-overlay {
    position: fixed;
    inset: 0;
    background: rgba(6, 10, 24, 0.85);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 200;
    backdrop-filter: blur(4px);
}

.confirm-dialog {
    background: var(--bg-card);
    border: 1px solid var(--pink);
    border-radius: var(--radius);
    padding: 24px;
    max-width: 400px;
    text-align: center;
    box-shadow: 0 0 40px var(--pink-glow);
}

.confirm-dialog p {
    color: var(--text-secondary);
    margin-bottom: 20px;
    font-size: 13px;
}

.confirm-dialog .btn-group {
    display: flex;
    gap: 10px;
    justify-content: center;
}

.confirm-dialog .btn-confirm {
    padding: 8px 20px;
    border: 1px solid var(--red);
    border-radius: 6px;
    background: rgba(248, 113, 113, 0.15);
    color: var(--red);
    font-family: inherit;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.2s;
}

.confirm-dialog .btn-confirm:hover {
    background: rgba(248, 113, 113, 0.3);
}

.confirm-dialog .btn-cancel {
    padding: 8px 20px;
    border: 1px solid var(--border-frost);
    border-radius: 6px;
    background: rgba(37, 99, 235, 0.08);
    color: var(--text-secondary);
    font-family: inherit;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.2s;
}

.confirm-dialog .btn-cancel:hover {
    background: rgba(37, 99, 235, 0.18);
    color: var(--text-primary);
}

/* SSH Security */
.period-toggle {
    display: inline-flex;
    gap: 2px;
    margin-left: 10px;
    vertical-align: middle;
}

.period-btn {
    font-family: inherit;
    font-size: 10px;
    font-weight: 600;
    padding: 3px 10px;
    border: 1px solid rgba(37, 99, 235, 0.15);
    border-radius: 4px;
    background: rgba(37, 99, 235, 0.06);
    color: var(--text-muted);
    cursor: pointer;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    transition: all 0.2s;
}

.period-btn:hover {
    background: rgba(37, 99, 235, 0.12);
    color: var(--text-secondary);
}

.period-btn.active {
    background: rgba(37, 99, 235, 0.2);
    border-color: var(--accent-light);
    color: var(--accent-bright);
}

.title-period {
    font-size: 10px;
    font-weight: 400;
    color: var(--text-muted);
    letter-spacing: 1px;
}

.ssh-summary {
    display: flex;
    gap: 12px;
    margin-bottom: 20px;
}

.ssh-stat {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 12px 24px;
    border-radius: var(--radius-sm);
    border: 1px solid rgba(37, 99, 235, 0.1);
    min-width: 100px;
}

.ssh-stat-ok {
    background: rgba(52, 211, 153, 0.06);
    border-color: rgba(52, 211, 153, 0.15);
}

.ssh-stat-fail {
    background: rgba(248, 113, 113, 0.06);
    border-color: rgba(248, 113, 113, 0.15);
}

.ssh-stat-ips {
    background: rgba(251, 191, 36, 0.06);
    border-color: rgba(251, 191, 36, 0.15);
}

.ssh-stat-value {
    font-size: 22px;
    font-weight: 700;
    font-variant-numeric: tabular-nums;
    line-height: 1.2;
}

.ssh-stat-ok .ssh-stat-value { color: var(--green); }
.ssh-stat-fail .ssh-stat-value { color: var(--red); }
.ssh-stat-ips .ssh-stat-value { color: var(--amber); }

.ssh-stat-label {
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    color: var(--text-muted);
    margin-top: 2px;
}

.ssh-columns {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 16px;
}

.ssh-col-title {
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--text-secondary);
    margin-bottom: 10px;
    padding-bottom: 8px;
    border-bottom: 1px solid rgba(37, 99, 235, 0.1);
}

.ssh-list {
    display: flex;
    flex-direction: column;
    gap: 4px;
    max-height: 260px;
    overflow-y: auto;
}

.ssh-entry {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 6px 10px;
    border-radius: 4px;
    font-size: 11px;
    gap: 8px;
}

.ssh-entry-fail {
    background: rgba(248, 113, 113, 0.04);
    border-left: 2px solid rgba(248, 113, 113, 0.3);
}

.ssh-entry-ok {
    background: rgba(52, 211, 153, 0.04);
    border-left: 2px solid rgba(52, 211, 153, 0.3);
}

.ssh-entry-offender {
    background: rgba(248, 113, 113, 0.06);
    border-left: 2px solid var(--red);
}

.ssh-entry-ip {
    font-family: inherit;
    color: var(--text-primary);
    font-weight: 500;
    min-width: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.ssh-entry-user {
    color: var(--accent-bright);
    font-weight: 500;
}

.ssh-entry-meta {
    display: flex;
    gap: 8px;
    flex-shrink: 0;
    color: var(--text-muted);
    font-variant-numeric: tabular-nums;
}

.ssh-entry-count {
    color: var(--red);
    font-weight: 700;
    font-size: 12px;
    min-width: 30px;
    text-align: right;
}

.ssh-entry-time {
    color: var(--text-muted);
    font-size: 10px;
}

.ssh-entry-method {
    font-size: 10px;
    padding: 1px 6px;
    border-radius: 3px;
    background: rgba(37, 99, 235, 0.08);
    color: var(--text-muted);
}

/* Scrollbar */
::-webkit-scrollbar {
    width: 6px;
    height: 6px;
}

::-webkit-scrollbar-track {
    background: transparent;
}

::-webkit-scrollbar-thumb {
    background: rgba(37, 99, 235, 0.2);
    border-radius: 3px;
}

::-webkit-scrollbar-thumb:hover {
    background: rgba(37, 99, 235, 0.35);
}
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <svg class="logo-icon" viewBox="0 0 24 24" width="28" height="28" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
            </svg>
            <h1>ARCTIC MONITOR</h1>
        </div>
        <div class="header-right">
            <div class="header-actions">
                <button class="btn-action" onclick="alert('Preview mode - actions disabled')" title="apt update && apt upgrade">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" y1="22" x2="4" y2="15"/></svg>
                    Debian Update
                </button>
                <button class="btn-action" onclick="alert('Preview mode - actions disabled')" title="Pull latest images and prune unused">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 2v6h-6M3 12a9 9 0 0115.56-6.14L21 8M3 22v-6h6M21 12a9 9 0 01-15.56 6.14L3 16"/></svg>
                    Stack Update
                </button>
                <button class="btn-action" onclick="alert('Preview mode - actions disabled')" title="Restart all containers">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 11-2.12-9.36L23 10"/></svg>
                    Restart Stack
                </button>
                <button class="btn-action danger" onclick="alert('Preview mode - actions disabled')" title="Reboot the server">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18.36 6.64A9 9 0 005.64 18.36M18.36 18.36A9 9 0 005.64 5.64"/><line x1="12" y1="2" x2="12" y2="6"/></svg>
                    Reboot VM
                </button>
            </div>
            <span class="header-uptime" id="server-uptime">--</span>
            <span class="header-clock" id="clock">--:--:--</span>
            <span class="sse-status" id="sse-status" title="SSE connection status"></span>
        </div>
    </header>

    <main class="dashboard">
        <!-- Host Metrics -->
        <section class="card card-wide" id="host-section">
            <h2 class="card-title"><svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2"/><path d="M8 21h8M12 17v4"/></svg> Host Metrics</h2>
            <div class="metrics-grid-main" id="host-metrics">
                <div class="metric">
                    <div class="metric-header"><span>RAM</span><span id="ram-value">--%</span></div>
                    <div class="bar"><div class="bar-fill bar-ram" id="ram-bar" style="width:0%"></div></div>
                </div>
                <div class="metric">
                    <div class="metric-header"><span>GPU</span><span id="gpu-value">--%</span></div>
                    <div class="bar"><div class="bar-fill bar-gpu" id="gpu-bar" style="width:0%"></div></div>
                </div>
                <div class="metric">
                    <div class="metric-header"><span>Swap</span><span id="swap-value">--%</span></div>
                    <div class="bar"><div class="bar-fill bar-swap" id="swap-bar" style="width:0%"></div></div>
                </div>
            </div>
            <div class="cpu-cores-section">
                <div class="cpu-cores-grid" id="cpu-cores"></div>
            </div>
            <div class="metrics-grid-disks" id="disk-metrics"></div>
            <div class="metrics-info">
                <span id="gpu-info" class="info-chip">GPU: --</span>
                <span id="gpu-temp" class="info-chip">GPU Temp: --</span>
                <span id="gpu-mem" class="info-chip">VRAM: --</span>
                <span id="ssh-count" class="info-chip">SSH: 0</span>
            </div>
        </section>

        <!-- Library Stats -->
        <section class="card card-full" id="library-section">
            <h2 class="card-title"><svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 016.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 014 19.5v-15A2.5 2.5 0 016.5 2z"/></svg> Library</h2>
            <div class="library-grid" id="library-grid">
                <div class="library-stat"><div class="library-stat-value" id="lib-movies">--</div><div class="library-stat-label">Movies</div></div>
                <div class="library-stat"><div class="library-stat-value" id="lib-series">--</div><div class="library-stat-label">Shows</div></div>
                <div class="library-stat"><div class="library-stat-value" id="lib-episodes">--</div><div class="library-stat-label">Episodes</div></div>
                <div class="library-stat"><div class="library-stat-value" id="lib-music">--</div><div class="library-stat-label">Tracks</div></div>
            </div>
        </section>

        <!-- Service Grid -->
        <section class="card card-full" id="services-section">
            <h2 class="card-title"><svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12H2M5.45 5.11L2 12v6a2 2 0 002 2h16a2 2 0 002-2v-6l-3.45-6.89A2 2 0 0016.76 4H7.24a2 2 0 00-1.79 1.11z"/><line x1="6" y1="16" x2="6.01" y2="16"/><line x1="10" y1="16" x2="10.01" y2="16"/></svg> Services</h2>
            <div class="service-grid" id="service-grid"></div>
        </section>

        <!-- Active Streams -->
        <section class="card card-full" id="streams-section">
            <h2 class="card-title"><svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"/></svg> Active Streams</h2>
            <div class="table-wrap" id="streams-table">
                <p class="empty-state">No active streams</p>
            </div>
        </section>

        <!-- Torrents -->
        <section class="card card-half" id="torrents-section">
            <h2 class="card-title"><svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg> Torrents</h2>
            <div id="torrent-stats" class="torrent-stats">
                <div class="stat-row"><span class="stat-label">Download</span><span class="stat-value" id="torrent-dl">--</span></div>
                <div class="stat-row"><span class="stat-label">Upload</span><span class="stat-value" id="torrent-ul">--</span></div>
                <div class="stat-row"><span class="stat-label">Ratio</span><span class="stat-value" id="torrent-ratio">--</span></div>
                <div class="stat-row"><span class="stat-label">Active / Seeding / Total</span><span class="stat-value" id="torrent-counts">-- / -- / --</span></div>
            </div>
            <div id="torrent-list" class="torrent-list"></div>
        </section>

        <!-- Download Queues -->
        <section class="card card-half" id="downloads-section">
            <h2 class="card-title"><svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v14M5 10l7 7 7-7"/><path d="M21 17v2a2 2 0 01-2 2H5a2 2 0 01-2-2v-2"/></svg> Download Queue</h2>
            <div id="download-list" class="download-list"><p class="empty-state">Queue empty</p></div>
        </section>

        <!-- Recent Requests -->
        <section class="card card-half" id="requests-section">
            <h2 class="card-title"><svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 3h4a2 2 0 012 2v14a2 2 0 01-2 2h-4M10 17l5-5-5-5M15 12H3"/></svg> Recent Requests</h2>
            <div id="request-list" class="request-list"><p class="empty-state">No recent requests</p></div>
        </section>

        <!-- Transcoding -->
        <section class="card card-half" id="transcoding-section">
            <h2 class="card-title"><svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.7 6.3a1 1 0 000 1.4l1.6 1.6a1 1 0 001.4 0l3.77-3.77a6 6 0 01-7.94 7.94l-6.91 6.91a2.12 2.12 0 01-3-3l6.91-6.91a6 6 0 017.94-7.94l-3.76 3.76z"/></svg> Transcoding</h2>
            <div id="transcode-info" class="transcode-info"><span class="info-chip" id="transcode-pending">Pending: --</span></div>
            <div id="transcode-workers" class="transcode-workers"><p class="empty-state">No active workers</p></div>
        </section>

        <!-- Health Warnings -->
        <section class="card card-full" id="health-section">
            <h2 class="card-title"><svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg> Health Warnings</h2>
            <div id="health-list" class="health-list"><p class="empty-state">All systems healthy</p></div>
        </section>

        <!-- SSH Security -->
        <section class="card card-full" id="ssh-section">
            <h2 class="card-title">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg> SSH Security
                <span class="period-toggle" id="ssh-period-toggle">
                    <button class="period-btn active" data-period="24h">24h</button>
                    <button class="period-btn" data-period="7d">7d</button>
                    <button class="period-btn" data-period="30d">30d</button>
                </span>
            </h2>
            <div class="ssh-summary" id="ssh-summary">
                <div class="ssh-stat ssh-stat-ok"><span class="ssh-stat-value" id="ssh-accepted">--</span><span class="ssh-stat-label">Accepted</span></div>
                <div class="ssh-stat ssh-stat-fail"><span class="ssh-stat-value" id="ssh-failed">--</span><span class="ssh-stat-label">Failed</span></div>
                <div class="ssh-stat ssh-stat-ips"><span class="ssh-stat-value" id="ssh-unique-ips">--</span><span class="ssh-stat-label">Unique IPs</span></div>
            </div>
            <div class="ssh-columns">
                <div class="ssh-col">
                    <h3 class="ssh-col-title">
                        <svg class="inline-icon err" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
                        Top Offenders
                    </h3>
                    <div id="ssh-offenders" class="ssh-list"><p class="empty-state">No failed attempts</p></div>
                </div>
                <div class="ssh-col">
                    <h3 class="ssh-col-title">
                        <svg class="inline-icon warn" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
                        Recent Failed
                    </h3>
                    <div id="ssh-recent-failed" class="ssh-list"><p class="empty-state">No failed attempts</p></div>
                </div>
                <div class="ssh-col">
                    <h3 class="ssh-col-title">
                        <svg class="inline-icon ok" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                        Recent Accepted
                    </h3>
                    <div id="ssh-recent-accepted" class="ssh-list"><p class="empty-state">No logins</p></div>
                </div>
            </div>
        </section>
    </main>

    <!-- Confirm dialog (hidden) -->
    <div id="confirm-overlay" class="confirm-overlay" style="display:none">
        <div class="confirm-dialog">
            <p id="confirm-message"></p>
            <div class="btn-group">
                <button class="btn-cancel" onclick="closeConfirm()">Cancel</button>
                <button class="btn-confirm" id="confirm-btn">Confirm</button>
            </div>
        </div>
    </div>

    <script>
// ===== utils.js (inlined) =====

function formatBytes(bytes) {
    if (bytes === 0 || bytes == null) return '0 B';
    const units = ['B', 'KB', 'MB', 'GB', 'TB'];
    const i = Math.floor(Math.log(bytes) / Math.log(1024));
    return (bytes / Math.pow(1024, i)).toFixed(i > 1 ? 1 : 0) + ' ' + units[i];
}

function formatSpeed(bytesPerSec) {
    if (bytesPerSec === 0 || bytesPerSec == null) return '0 B/s';
    const units = ['B/s', 'KB/s', 'MB/s', 'GB/s'];
    const i = Math.floor(Math.log(bytesPerSec) / Math.log(1024));
    return (bytesPerSec / Math.pow(1024, i)).toFixed(1) + ' ' + units[i];
}

function formatPercent(val) {
    if (val == null) return '--%';
    return val.toFixed(1) + '%';
}

function timeAgo(dateStr) {
    if (!dateStr) return '--';
    const date = new Date(dateStr);
    const now = new Date();
    const seconds = Math.floor((now - date) / 1000);

    if (seconds < 60) return 'just now';
    if (seconds < 3600) return Math.floor(seconds / 60) + 'm ago';
    if (seconds < 86400) return Math.floor(seconds / 3600) + 'h ago';
    return Math.floor(seconds / 86400) + 'd ago';
}

function truncate(str, len) {
    if (!str) return '';
    return str.length > len ? str.substring(0, len) + '...' : str;
}

function esc(str) {
    if (!str) return '';
    const div = document.createElement('div');
    div.textContent = str;
    return div.innerHTML;
}

// ===== components.js (inlined) =====

const icons = {
    service: {
        jellyfin:    '<svg class="svc-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>',
        radarr:      '<svg class="svc-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M14.31 8l5.74 9.94M9.69 8h11.48M7.38 12l5.74-9.94M9.69 16L3.95 6.06M14.31 16H2.83M16.62 12l-5.74 9.94"/></svg>',
        sonarr:      '<svg class="svc-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="15" rx="2" ry="2"/><polyline points="17 2 12 7 7 2"/></svg>',
        seerr:       '<svg class="svc-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>',
        prowlarr:    '<svg class="svc-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/><line x1="11" y1="8" x2="11" y2="14"/><line x1="8" y1="11" x2="14" y2="11"/></svg>',
        bazarr:      '<svg class="svc-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>',
        qbittorrent: '<svg class="svc-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>',
        sabnzbd:     '<svg class="svc-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v14M5 10l7 7 7-7"/><path d="M21 17v2a2 2 0 01-2 2H5a2 2 0 01-2-2v-2"/></svg>',
        gluetun:     '<svg class="svc-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>',
        flaresolverr:'<svg class="svc-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>',
        unmanic:     '<svg class="svc-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.7 6.3a1 1 0 000 1.4l1.6 1.6a1 1 0 001.4 0l3.77-3.77a6 6 0 01-7.94 7.94l-6.91 6.91a2.12 2.12 0 01-3-3l6.91-6.91a6 6 0 017.94-7.94l-3.76 3.76z"/></svg>',
        npm:         '<svg class="svc-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>',
        arcticmon:   '<svg class="svc-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>',
        autoheal:    '<svg class="svc-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z"/></svg>',
    },
    _default: '<svg class="svc-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"/></svg>'
};

function getSvcIcon(name) {
    return icons.service[name] || icons._default;
}

function renderHost(host) {
    var ramBar = document.getElementById('ram-bar');
    var gpuBar = document.getElementById('gpu-bar');
    var swapBar = document.getElementById('swap-bar');

    var coresContainer = document.getElementById('cpu-cores');

    if (host.cpuCores && host.cpuCores.length > 0) {
        var avgPct = host.cpuPercent.toFixed(0);
        var avgBar = '<div class="cpu-core cpu-core-avg">' +
            '<div class="cpu-core-bar">' +
                '<div class="cpu-core-fill" style="width:' + host.cpuPercent.toFixed(1) + '%"></div>' +
                '<span class="cpu-core-id">AVG</span>' +
                '<span class="cpu-core-pct">' + avgPct + '%</span>' +
            '</div>' +
        '</div>';
        coresContainer.innerHTML = avgBar + host.cpuCores.map(function(c) {
            var pct = c.percent.toFixed(0);
            return '<div class="cpu-core">' +
                '<div class="cpu-core-bar">' +
                    '<div class="cpu-core-fill" style="width:' + c.percent.toFixed(1) + '%"></div>' +
                    '<span class="cpu-core-id">' + c.id + '</span>' +
                    '<span class="cpu-core-pct">' + pct + '%</span>' +
                '</div>' +
            '</div>';
        }).join('');
    }

    ramBar.style.width = host.memPercent.toFixed(1) + '%';
    document.getElementById('ram-value').textContent =
        formatPercent(host.memPercent) + ' (' + formatBytes(host.memUsed) + '/' + formatBytes(host.memTotal) + ')';

    if (host.gpu && host.gpu.available) {
        gpuBar.style.width = host.gpu.utilPercent + '%';
        document.getElementById('gpu-value').textContent = host.gpu.utilPercent + '%';
        document.getElementById('gpu-info').textContent = 'GPU: ' + esc(host.gpu.name);
        document.getElementById('gpu-temp').textContent = 'GPU Temp: ' + host.gpu.tempC + '\u00B0C';
        document.getElementById('gpu-mem').textContent =
            'VRAM: ' + formatBytes(host.gpu.memUsed) + '/' + formatBytes(host.gpu.memTotal);
    } else {
        gpuBar.style.width = '0%';
        document.getElementById('gpu-value').textContent = 'N/A';
        document.getElementById('gpu-info').textContent = 'GPU: unavailable';
        document.getElementById('gpu-temp').textContent = '';
        document.getElementById('gpu-mem').textContent = '';
    }

    swapBar.style.width = (host.swapPercent || 0).toFixed(1) + '%';
    if (host.swapTotal > 0) {
        document.getElementById('swap-value').textContent =
            formatPercent(host.swapPercent) + ' (' + formatBytes(host.swapUsed) + '/' + formatBytes(host.swapTotal) + ')';
    } else {
        document.getElementById('swap-value').textContent = 'None';
    }

    var diskContainer = document.getElementById('disk-metrics');
    if (host.disks && host.disks.length > 0) {
        diskContainer.innerHTML = host.disks.map(function(d, i) {
            var barClass = i === 0 ? 'bar-disk-nvme' : 'bar-disk-hdd';
            return '<div class="metric">' +
                '<div class="metric-header"><span>' + esc(d.label) + '</span><span>' + formatPercent(d.percent) + ' (' + formatBytes(d.used) + '/' + formatBytes(d.total) + ')</span></div>' +
                '<div class="bar"><div class="bar-fill ' + barClass + '" style="width:' + d.percent.toFixed(1) + '%"></div></div>' +
            '</div>';
        }).join('');
    } else {
        diskContainer.innerHTML = '';
    }

    document.getElementById('ssh-count').textContent = 'SSH: ' + (host.sshSessions || 0);
    document.getElementById('server-uptime').textContent = host.uptime || '--';
}

function renderServices(services) {
    var grid = document.getElementById('service-grid');
    if (!services || services.length === 0) {
        grid.innerHTML = '<p class="empty-state">No services detected</p>';
        return;
    }

    grid.innerHTML = services.map(function(svc) {
        var tag = svc.externalUrl ? 'a' : 'div';
        var href = svc.externalUrl ? ' href="' + esc(svc.externalUrl) + '" target="_blank" rel="noopener"' : '';
        var healthClass = svc.health || 'stopped';
        var icon = getSvcIcon(svc.name);
        var linkIcon = svc.externalUrl ? '<svg class="link-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>' : '';
        return '<' + tag + ' class="service-card"' + href + '>' +
            '<span class="service-dot ' + healthClass + '"></span>' +
            icon +
            '<div class="service-info">' +
                '<div class="service-name">' + esc(svc.name) + linkIcon + '</div>' +
                '<div class="service-meta">' + esc(svc.image) + ' \u00B7 ' + esc(svc.uptime) + '</div>' +
            '</div>' +
        '</' + tag + '>';
    }).join('');
}

function renderStreams(streams) {
    var wrap = document.getElementById('streams-table');
    if (!streams || streams.length === 0) {
        wrap.innerHTML = '<p class="empty-state">No active streams</p>';
        return;
    }

    wrap.innerHTML = '<table class="streams-table">' +
        '<thead><tr>' +
            '<th>User</th><th>Title</th><th>Progress</th><th>Client</th><th>Method</th>' +
        '</tr></thead>' +
        '<tbody>' + streams.map(function(s) {
            var title = s.series
                ? esc(s.series) + ' ' + esc(s.episode) + ' - ' + esc(s.title)
                : esc(s.title);
            var methodIcon = s.transcoding
                ? '<svg class="inline-icon warn" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.7 6.3a1 1 0 000 1.4l1.6 1.6a1 1 0 001.4 0l3.77-3.77a6 6 0 01-7.94 7.94l-6.91 6.91a2.12 2.12 0 01-3-3l6.91-6.91a6 6 0 017.94-7.94l-3.76 3.76z"/></svg>'
                : '<svg class="inline-icon ok" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>';
            return '<tr>' +
                '<td>' + esc(s.user) + '</td>' +
                '<td>' + title + '</td>' +
                '<td>' +
                    '<span class="progress-mini"><span class="progress-mini-fill" style="width:' + s.progress.toFixed(1) + '%"></span></span>' +
                    s.progress.toFixed(0) + '%' +
                '</td>' +
                '<td>' + esc(s.client) + '</td>' +
                '<td>' + methodIcon + ' ' + esc(s.playMethod) + '</td>' +
            '</tr>';
        }).join('') + '</tbody></table>';
}

function renderTorrents(torrents) {
    document.getElementById('torrent-dl').textContent = formatSpeed(torrents.dlSpeed);
    document.getElementById('torrent-ul').textContent = formatSpeed(torrents.upSpeed);
    document.getElementById('torrent-ratio').textContent = torrents.ratio ? torrents.ratio.toFixed(2) : '--';
    document.getElementById('torrent-counts').textContent =
        torrents.activeCount + ' / ' + torrents.seedingCount + ' / ' + torrents.totalCount;

    var list = document.getElementById('torrent-list');
    if (!torrents.topTorrents || torrents.topTorrents.length === 0) {
        list.innerHTML = '<p class="empty-state">No active torrents</p>';
        return;
    }

    list.innerHTML = torrents.topTorrents.map(function(t) {
        return '<div class="torrent-item">' +
            '<span class="torrent-item-name" title="' + esc(t.name) + '">' + esc(truncate(t.name, 50)) + '</span>' +
            '<span class="torrent-item-stats">' +
                '<span>\u2193 ' + formatSpeed(t.dlSpeed) + '</span>' +
                '<span>\u2191 ' + formatSpeed(t.upSpeed) + '</span>' +
                '<span>' + t.progress.toFixed(0) + '%</span>' +
            '</span>' +
        '</div>';
    }).join('');
}

function renderDownloads(downloads) {
    var list = document.getElementById('download-list');
    if (!downloads || downloads.length === 0) {
        list.innerHTML = '<p class="empty-state">Queue empty</p>';
        return;
    }

    list.innerHTML = downloads.map(function(d) {
        return '<div class="download-item">' +
            '<span class="download-item-name" title="' + esc(d.title) + '">' +
                '<span class="status-badge ' + d.source.toLowerCase() + '">' + esc(d.source) + '</span>' +
                ' ' + esc(truncate(d.title, 45)) +
            '</span>' +
            '<span class="download-item-stats">' +
                '<span class="download-progress"><span class="download-progress-fill" style="width:' + d.progress.toFixed(1) + '%"></span></span>' +
                '<span>' + d.progress.toFixed(0) + '%</span>' +
                '<span>' + (d.timeleft || '--') + '</span>' +
            '</span>' +
        '</div>';
    }).join('');
}

function renderRequests(requests) {
    var list = document.getElementById('request-list');
    if (!requests || requests.length === 0) {
        list.innerHTML = '<p class="empty-state">No recent requests</p>';
        return;
    }

    list.innerHTML = requests.map(function(r) {
        return '<div class="request-item">' +
            '<span class="request-item-name">' +
                '<span class="status-badge ' + r.status.toLowerCase() + '">' + esc(r.status) + '</span>' +
                ' ' + esc(r.title) +
            '</span>' +
            '<span class="request-item-meta">' +
                '<span>' + esc(r.user) + '</span>' +
                '<span>' + timeAgo(r.requestedAt) + '</span>' +
            '</span>' +
        '</div>';
    }).join('');
}

function renderTranscoding(transcodes) {
    document.getElementById('transcode-pending').textContent = 'Pending: ' + (transcodes.pending || 0);

    var list = document.getElementById('transcode-workers');
    if (!transcodes.workers || transcodes.workers.length === 0) {
        list.innerHTML = '<p class="empty-state">No active workers</p>';
        return;
    }

    list.innerHTML = transcodes.workers.map(function(w) {
        var isIdle = w.status === 'idle';
        return '<div class="worker-card">' +
            '<div class="worker-header">' +
                '<span class="worker-file">' + (isIdle ? 'Idle' : esc(truncate(w.fileName, 50))) + '</span>' +
                '<span class="worker-stats">' + (isIdle ? '' : w.progress.toFixed(1) + '% \u00B7 ' + (w.speed || '--')) + '</span>' +
            '</div>' +
            (isIdle ? '' : '<div class="bar"><div class="bar-fill bar-gpu" style="width:' + w.progress.toFixed(1) + '%"></div></div>') +
        '</div>';
    }).join('');
}

function renderLibrary(lib) {
    if (!lib) return;
    document.getElementById('lib-movies').textContent = (lib.movies || 0).toLocaleString();
    document.getElementById('lib-series').textContent = (lib.series || 0).toLocaleString();
    document.getElementById('lib-episodes').textContent = (lib.episodes || 0).toLocaleString();
    document.getElementById('lib-music').textContent = (lib.songs || 0).toLocaleString();
}

function renderHealth(health) {
    var list = document.getElementById('health-list');
    if (!health || health.length === 0) {
        list.innerHTML = '<p class="empty-state">All systems healthy</p>';
        return;
    }

    list.innerHTML = health.map(function(h) {
        var icon = h.type === 'error'
            ? '<svg class="inline-icon err" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>'
            : '<svg class="inline-icon warn" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>';
        return '<div class="health-item ' + (h.type === 'error' ? 'error' : '') + '">' +
            icon +
            '<span class="health-source">' + esc(h.source) + '</span>' +
            '<span class="health-message">' + esc(h.message) + '</span>' +
        '</div>';
    }).join('');
}

var _sshData = null;
var _sshPeriod = '24h';

function renderSSHSecurity(data) {
    if (!data) return;
    _sshData = data;

    updateSSHCounters();

    var offList = document.getElementById('ssh-offenders');
    if (!data.topOffenders || data.topOffenders.length === 0) {
        offList.innerHTML = '<p class="empty-state">No failed attempts</p>';
    } else {
        offList.innerHTML = data.topOffenders.map(function(o) {
            return '<div class="ssh-entry ssh-entry-offender">' +
                '<span class="ssh-entry-ip">' + esc(o.ip) + '</span>' +
                '<span class="ssh-entry-meta">' +
                    '<span class="ssh-entry-time">' + timeAgo(o.lastSeen) + '</span>' +
                    '<span class="ssh-entry-count">' + o.attempts + '</span>' +
                '</span>' +
            '</div>';
        }).join('');
    }

    var failList = document.getElementById('ssh-recent-failed');
    if (!data.recentFailed || data.recentFailed.length === 0) {
        failList.innerHTML = '<p class="empty-state">No failed attempts</p>';
    } else {
        failList.innerHTML = data.recentFailed.map(function(e) {
            return '<div class="ssh-entry ssh-entry-fail">' +
                '<span class="ssh-entry-user">' + esc(e.user) + '</span>' +
                '<span class="ssh-entry-ip">' + esc(e.ip) + '</span>' +
                '<span class="ssh-entry-meta">' +
                    '<span class="ssh-entry-method">' + esc(e.method) + '</span>' +
                    '<span class="ssh-entry-time">' + timeAgo(e.time) + '</span>' +
                '</span>' +
            '</div>';
        }).join('');
    }

    var okList = document.getElementById('ssh-recent-accepted');
    if (!data.recentAccepted || data.recentAccepted.length === 0) {
        okList.innerHTML = '<p class="empty-state">No logins</p>';
    } else {
        okList.innerHTML = data.recentAccepted.map(function(e) {
            return '<div class="ssh-entry ssh-entry-ok">' +
                '<span class="ssh-entry-user">' + esc(e.user) + '</span>' +
                '<span class="ssh-entry-ip">' + esc(e.ip) + '</span>' +
                '<span class="ssh-entry-meta">' +
                    '<span class="ssh-entry-method">' + esc(e.method) + '</span>' +
                    '<span class="ssh-entry-time">' + timeAgo(e.time) + '</span>' +
                '</span>' +
            '</div>';
        }).join('');
    }
}

function updateSSHCounters() {
    if (!_sshData) return;
    var d = _sshData;
    var accepted, failed;
    if (_sshPeriod === '7d') {
        accepted = d.accepted7d || 0;
        failed = d.failed7d || 0;
    } else if (_sshPeriod === '30d') {
        accepted = d.accepted30d || 0;
        failed = d.failed30d || 0;
    } else {
        accepted = d.accepted24h || 0;
        failed = d.failed24h || 0;
    }
    document.getElementById('ssh-accepted').textContent = accepted.toLocaleString();
    document.getElementById('ssh-failed').textContent = failed.toLocaleString();
    document.getElementById('ssh-unique-ips').textContent =
        (d.topOffenders ? d.topOffenders.length : 0).toLocaleString();
}

// Period toggle click handler
document.getElementById('ssh-period-toggle').addEventListener('click', function(e) {
    var btn = e.target.closest('.period-btn');
    if (!btn) return;
    _sshPeriod = btn.dataset.period;
    this.querySelectorAll('.period-btn').forEach(function(b) { b.classList.remove('active'); });
    btn.classList.add('active');
    updateSSHCounters();
});

// ===== Preview stubs for app.js action handlers =====

function doAction() { alert('Preview mode - actions disabled'); }
function confirmAction() { alert('Preview mode - actions disabled'); }
function closeConfirm() {
    document.getElementById('confirm-overlay').style.display = 'none';
}

// ===== Clock update =====

(function() {
    function updateClock() {
        var now = new Date();
        document.getElementById('clock').textContent = now.toLocaleTimeString('en-GB', {
            hour: '2-digit', minute: '2-digit', second: '2-digit'
        });
    }
    setInterval(updateClock, 1000);
    updateClock();
})();

// ===== Mark SSE status as connected =====

document.getElementById('sse-status').className = 'sse-status connected';
document.getElementById('sse-status').title = 'Connected (preview)';

// ===== Render all sections with mock data =====

(function() {
    var now = new Date();
    function ago(minutes) {
        return new Date(now.getTime() - minutes * 60000).toISOString();
    }

    // --- Host ---
    renderHost({
        cpuPercent: 34.2,
        cpuCores: [
            { id: 'C0',  percent: 42 },
            { id: 'C1',  percent: 18 },
            { id: 'C2',  percent: 67 },
            { id: 'C3',  percent: 5 },
            { id: 'C4',  percent: 85 },
            { id: 'C5',  percent: 31 },
            { id: 'C6',  percent: 53 },
            { id: 'C7',  percent: 12 },
            { id: 'C8',  percent: 74 },
            { id: 'C9',  percent: 28 },
            { id: 'C10', percent: 46 },
            { id: 'C11', percent: 9 }
        ],
        memTotal: 34359738368,
        memUsed: 18253611008,
        memPercent: 53.1,
        swapTotal: 8589934592,
        swapUsed: 1073741824,
        swapPercent: 12.5,
        gpu: {
            name: 'NVIDIA GeForce RTX 3060',
            tempC: 61,
            utilPercent: 42,
            memUsed: 2147483648,
            memTotal: 12884901888,
            available: true
        },
        disks: [
            { label: 'NVMe SSD (/)', percent: 72, used: 412316860416, total: 572662306816 },
            { label: 'HDD (/mnt/storage)', percent: 45, used: 1932735283200, total: 4294967296000 }
        ],
        sshSessions: 2,
        uptime: '12d 8h 23m'
    });

    // --- Library ---
    renderLibrary({
        movies: 842,
        series: 156,
        episodes: 4523,
        songs: 2841
    });

    // --- Services (15 with mixed health) ---
    renderServices([
        { name: 'jellyfin',     health: 'healthy',   image: 'jellyfin/jellyfin:10.9',       uptime: '12d 8h',  externalUrl: 'https://jellyfin.example.com' },
        { name: 'radarr',       health: 'healthy',   image: 'lscr.io/radarr:5.6',           uptime: '12d 8h',  externalUrl: 'https://radarr.example.com' },
        { name: 'sonarr',       health: 'healthy',   image: 'lscr.io/sonarr:4.0',           uptime: '12d 8h',  externalUrl: 'https://sonarr.example.com' },
        { name: 'seerr',        health: 'healthy',   image: 'sctx/overseerr:1.33',          uptime: '12d 8h',  externalUrl: 'https://seerr.example.com' },
        { name: 'prowlarr',     health: 'healthy',   image: 'lscr.io/prowlarr:1.16',        uptime: '12d 8h',  externalUrl: 'https://prowlarr.example.com' },
        { name: 'bazarr',       health: 'healthy',   image: 'lscr.io/bazarr:1.4',           uptime: '12d 8h',  externalUrl: 'https://bazarr.example.com' },
        { name: 'qbittorrent',  health: 'healthy',   image: 'lscr.io/qbittorrent:4.6',      uptime: '12d 8h',  externalUrl: null },
        { name: 'sabnzbd',      health: 'healthy',   image: 'lscr.io/sabnzbd:4.3',          uptime: '12d 8h',  externalUrl: 'https://sabnzbd.example.com' },
        { name: 'gluetun',      health: 'healthy',   image: 'qmcgaw/gluetun:v3',            uptime: '12d 8h',  externalUrl: null },
        { name: 'flaresolverr', health: 'unhealthy', image: 'ghcr.io/flaresolverr:v3',      uptime: '2h 14m',  externalUrl: null },
        { name: 'unmanic',      health: 'healthy',   image: 'josh5/unmanic:0.2',             uptime: '12d 8h',  externalUrl: 'https://unmanic.example.com' },
        { name: 'npm',          health: 'healthy',   image: 'jc21/nginx-proxy-manager:2.11', uptime: '12d 8h',  externalUrl: 'https://npm.example.com' },
        { name: 'autoheal',     health: 'running',   image: 'willfarrell/autoheal:latest',   uptime: '12d 8h',  externalUrl: null }
    ]);

    // --- Streams (2 active) ---
    renderStreams([
        {
            user: 'alice',
            title: 'Inception',
            series: null,
            episode: null,
            progress: 64.3,
            client: 'Jellyfin Web (Chrome)',
            playMethod: 'DirectPlay',
            transcoding: false
        },
        {
            user: 'bob',
            title: 'The Rains of Castamere',
            series: 'Game of Thrones',
            episode: 'S03E09',
            progress: 22.8,
            client: 'Jellyfin iOS',
            playMethod: 'Transcode',
            transcoding: true
        }
    ]);

    // --- Torrents ---
    renderTorrents({
        dlSpeed: 5242880,
        upSpeed: 2097152,
        ratio: 1.42,
        activeCount: 3,
        seedingCount: 12,
        totalCount: 45,
        topTorrents: [
            { name: 'The.Matrix.1999.Remastered.2160p.UHD.BluRay.x265-GROUP', dlSpeed: 2621440, upSpeed: 524288, progress: 67 },
            { name: 'Dune.Part.Two.2024.1080p.BluRay.REMUX.AVC.DTS-HD.MA-FGT', dlSpeed: 1572864, upSpeed: 1048576, progress: 34 },
            { name: 'Shogun.S01.COMPLETE.2160p.DSNP.WEB-DL.DDP5.1.HDR.H265', dlSpeed: 1048576, upSpeed: 524288, progress: 89 }
        ]
    });

    // --- Downloads (3 items from different sources) ---
    renderDownloads([
        { title: 'Oppenheimer (2023) [Bluray-2160p]', source: 'Radarr', progress: 78.2, timeleft: '12m' },
        { title: 'Fallout S01E04 - The Ghouls [WEBDL-1080p]', source: 'Sonarr', progress: 45.1, timeleft: '28m' },
        { title: 'The.Last.of.Us.S02E01.720p.NF.WEB-DL', source: 'SABnzbd', progress: 12.6, timeleft: '1h 04m' }
    ]);

    // --- Requests (4 seerr requests) ---
    renderRequests([
        { title: 'Dune: Part Three', status: 'Pending', user: 'charlie', requestedAt: ago(25) },
        { title: 'Severance Season 2', status: 'Approved', user: 'alice', requestedAt: ago(180) },
        { title: 'The Bear Season 4', status: 'Available', user: 'bob', requestedAt: ago(1440) },
        { title: 'Blade Runner 2099', status: 'Declined', user: 'dave', requestedAt: ago(4320) }
    ]);

    // --- Transcoding (1 active worker + 3 pending) ---
    renderTranscoding({
        pending: 3,
        workers: [
            { status: 'active', fileName: 'Game.of.Thrones.S03E09.The.Rains.of.Castamere.mkv', progress: 41.7, speed: '2.3x' }
        ]
    });

    // --- Health (2 warnings) ---
    renderHealth([
        { type: 'warning', source: 'Radarr', message: 'Indexer NZBgeek returned 0 results in the last 24 hours' },
        { type: 'error',   source: 'Flaresolverr', message: 'Container health check failing - restarted 3 times in last hour' }
    ]);

    // --- SSH Security ---
    renderSSHSecurity({
        failed24h: 47,
        failed7d: 312,
        failed30d: 1847,
        accepted24h: 8,
        accepted7d: 42,
        accepted30d: 156,
        topOffenders: [
            { ip: '185.224.128.43',  attempts: 312, lastSeen: ago(5) },
            { ip: '103.203.57.12',   attempts: 247, lastSeen: ago(18) },
            { ip: '45.148.10.74',    attempts: 189, lastSeen: ago(42) },
            { ip: '192.241.236.11',  attempts: 156, lastSeen: ago(120) },
            { ip: '218.92.0.107',    attempts: 134, lastSeen: ago(200) },
            { ip: '61.177.173.48',   attempts: 98,  lastSeen: ago(380) },
            { ip: '112.85.42.88',    attempts: 67,  lastSeen: ago(720) },
            { ip: '222.186.30.112',  attempts: 43,  lastSeen: ago(1440) }
        ],
        recentFailed: [
            { user: 'root',     ip: '185.224.128.43',  method: 'password', time: ago(5) },
            { user: 'admin',    ip: '103.203.57.12',   method: 'password', time: ago(11) },
            { user: 'ubuntu',   ip: '45.148.10.74',    method: 'password', time: ago(18) },
            { user: 'root',     ip: '192.241.236.11',  method: 'publickey', time: ago(27) },
            { user: 'test',     ip: '218.92.0.107',    method: 'password', time: ago(35) },
            { user: 'postgres', ip: '61.177.173.48',   method: 'password', time: ago(48) },
            { user: 'oracle',   ip: '112.85.42.88',    method: 'password', time: ago(62) },
            { user: 'root',     ip: '222.186.30.112',  method: 'password', time: ago(75) },
            { user: 'ftpuser',  ip: '185.224.128.43',  method: 'password', time: ago(90) },
            { user: 'root',     ip: '103.203.57.12',   method: 'keyboard-interactive', time: ago(110) }
        ],
        recentAccepted: [
            { user: 'admin', ip: '192.168.1.10',   method: 'publickey', time: ago(3) },
            { user: 'admin', ip: '192.168.1.10',   method: 'publickey', time: ago(120) },
            { user: 'deploy', ip: '10.0.0.5',       method: 'publickey', time: ago(360) },
            { user: 'admin', ip: '203.0.113.50',   method: 'publickey', time: ago(480) },
            { user: 'deploy', ip: '10.0.0.5',       method: 'publickey', time: ago(720) },
            { user: 'admin', ip: '192.168.1.10',   method: 'publickey', time: ago(1200) },
            { user: 'admin', ip: '203.0.113.50',   method: 'publickey', time: ago(2880) }
        ]
    });
})();
    </script>
</body>
</html>
